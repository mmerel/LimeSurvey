From 840846368c435a5d460edef28b69825ca5b92210 Mon Sep 17 00:00:00 2001
From: Merel <merel@alexander.khleuven.be>
Date: Wed, 8 Jul 2015 17:05:06 +0200
Subject: [PATCH] The function doAssessment(, true) in frontend_helper.php,
 returns also the group totals, not only the total.

---
 application/helpers/frontend_helper.php |   17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)

diff --git a/application/helpers/frontend_helper.php b/application/helpers/frontend_helper.php
index 774a19e..f08a43c 100644
--- a/application/helpers/frontend_helper.php
+++ b/application/helpers/frontend_helper.php
@@ -1782,8 +1782,14 @@ function doAssessment($surveyid, $returndataonly=false)
             }
         }
         $assessments = "";
+	$data_only = array('total'=>$total);
+
         if (isset($subtotal) && is_array($subtotal))
         {
+	    if ($returndataonly==true) {
+                $data_only["assessmentgroup"] = array();
+            }
+
             foreach($subtotal as $key=>$val)
             {
                 if (isset($assessment['group'][$key]))
@@ -1804,6 +1810,15 @@ function doAssessment($surveyid, $returndataonly=false)
                             </tr>
                             </table><br />\n";
                         }
+			if ($returndataonly==true) {
+                            $data_only["assessmentgroup"][] = 
+						(object) array (
+						"groupname"=>$assessed['name'],
+						"perc"=>$val, "total"=>$total, 
+						"max"=>$assessed['max'], "min" => $assessed['min'],
+						"message"=>$assessed['message']);
+
+                        }
                     }
                 }
             }
@@ -1831,7 +1846,7 @@ function doAssessment($surveyid, $returndataonly=false)
         }
         if ($returndataonly==true)
         {
-            return array('total'=>$total);
+            return $data_only;
         }
         else
         {
-- 
1.7.9.5

